
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Re-analyze Karp et al. (2105) data &#8212; Collaborative and Reproducible Data Science</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script >const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Collaborative and Reproducible Data Science</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../overview.html">
                    Statistics 159/259, Spring 2021 Course Summary
                </a>
            </li>
        </ul>
        <p class="caption">
 <span class="caption-text">
  Overview
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../schedule.html">
   Statistics 159/259: Weekly Plan
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Syllabus
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../syllabus.html">
   Syllabus for Statistics 159/259: Reproducible and Collaborative Statistical Data Science
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Homework Assignments
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Hw/hw01-background.html">
   1. Homework 1. Stats review and intro to Git
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Hw/hw02-election-fraud.html">
   2. Homework 2. Election Fraud
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Hw/hw03-testing.html">
   3. Homework 3: Coding style, docstrings, algorithmic choices, and unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Hw/hw04-phil-sci-covid.html">
   4. Homework 4: Reproducibility, Philosophy of Science, and COVID-19 Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Hw/hw05-selection-outliers.html">
   5. Homework 5: Selective inference and outlier rejection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Hw/hw06-cryptorandom-contrib.html">
   6. Homework 6: Cryptorandom - contributing to an open source project
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Hw/hw07-permute-contrib.html">
   7. Homework 7: Permute - contributing to an open source project
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Hw/hw08-final-project.html">
   8. Homework 8. Final Project - Antibody Cocktail Efficacy
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Lecture Notes
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="index.html">
   An Idiosyncratic Sample of Applied Statistics
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Lecture Index
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Index/index.html">
   Index of Lectures and Materials
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/Notes/karpEtal15.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/Notes/karpEtal15.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Re-analyze Karp et al. (2105) data
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#p-b-stark">
     P.B. Stark
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#significance-of-the-slope">
   Significance of the slope
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#standard-regression-model">
     Standard regression model
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#theorem-the-ols-estimate-is-unbiased-and-mathrm-cov-hat-beta-x-tx-1-x-t-mathrm-cov-epsilon-x-x-x-tx-1">
       Theorem: the OLS estimate is unbiased and
       <span class="math notranslate nohighlight">
        \(\mathrm{cov}(\hat{\beta}) = (X^TX)^{-1} X^T \mathrm{cov}(\epsilon | X) X (X^TX)^{-1}\)
       </span>
       .
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#the-t-test">
       The t-test
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#permutation-test">
     Permutation test
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#what-s-the-justification-for-this-model-here">
       What’s the justification for
       <em>
        this
       </em>
       model here?
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#another-approach-the-neyman-ticket-model">
       Another approach: the Neyman “ticket” model
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#how-to-shuffle">
   How to shuffle
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#proof-that-the-streaming-fisher-yates-knuth-durstenfeld-algorithm-works">
     Proof that the streaming Fisher-Yates-Knuth-Durstenfeld algorithm works
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#how-not-to-shuffle">
   How not to shuffle
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#how-to-generate-random-integers">
   How to generate random integers
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#how-r-generates-random-integers">
     How R generates random integers
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sensitivity-to-farm-31">
   Sensitivity to farm 31
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#fourth-root-transformation">
   Fourth-root transformation
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#th-root-without-farm-31">
     4th root without farm 31
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#questions">
   Questions:
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#technical-issues">
   Technical issues:
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Re-analyze Karp et al. (2105) data</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Re-analyze Karp et al. (2105) data
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#p-b-stark">
     P.B. Stark
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#significance-of-the-slope">
   Significance of the slope
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#standard-regression-model">
     Standard regression model
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#theorem-the-ols-estimate-is-unbiased-and-mathrm-cov-hat-beta-x-tx-1-x-t-mathrm-cov-epsilon-x-x-x-tx-1">
       Theorem: the OLS estimate is unbiased and
       <span class="math notranslate nohighlight">
        \(\mathrm{cov}(\hat{\beta}) = (X^TX)^{-1} X^T \mathrm{cov}(\epsilon | X) X (X^TX)^{-1}\)
       </span>
       .
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#the-t-test">
       The t-test
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#permutation-test">
     Permutation test
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#what-s-the-justification-for-this-model-here">
       What’s the justification for
       <em>
        this
       </em>
       model here?
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#another-approach-the-neyman-ticket-model">
       Another approach: the Neyman “ticket” model
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#how-to-shuffle">
   How to shuffle
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#proof-that-the-streaming-fisher-yates-knuth-durstenfeld-algorithm-works">
     Proof that the streaming Fisher-Yates-Knuth-Durstenfeld algorithm works
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#how-not-to-shuffle">
   How not to shuffle
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#how-to-generate-random-integers">
   How to generate random integers
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#how-r-generates-random-integers">
     How R generates random integers
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sensitivity-to-farm-31">
   Sensitivity to farm 31
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#fourth-root-transformation">
   Fourth-root transformation
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#th-root-without-farm-31">
     4th root without farm 31
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#questions">
   Questions:
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#technical-issues">
   Technical issues:
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <div class="section" id="re-analyze-karp-et-al-2105-data">
<h1>Re-analyze Karp et al. (2105) data<a class="headerlink" href="#re-analyze-karp-et-al-2105-data" title="Permalink to this headline">¶</a></h1>
<div class="section" id="p-b-stark">
<h2>P.B. Stark<a class="headerlink" href="#p-b-stark" title="Permalink to this headline">¶</a></h2>
<p>Python 3 notebook</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy</span> <span class="k">as</span> <span class="nn">sp</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">binom</span><span class="p">,</span> <span class="n">chi2</span><span class="p">,</span> <span class="n">hypergeom</span>
<span class="kn">import</span> <span class="nn">numbers</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">permute</span> <span class="k">as</span> <span class="nn">pt</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">import</span> <span class="nn">statsmodels.formula.api</span> <span class="k">as</span> <span class="nn">smf</span>

<span class="kn">from</span> <span class="nn">permute.utils</span> <span class="kn">import</span> <span class="n">binom_conf_interval</span>
<span class="kn">from</span> <span class="nn">cryptorandom</span> <span class="kn">import</span> <span class="n">cryptorandom</span> <span class="k">as</span> <span class="n">cr</span>
<span class="kn">from</span> <span class="nn">cryptorandom</span> <span class="kn">import</span> <span class="n">sample</span>

<span class="n">seed</span> <span class="o">=</span> <span class="s2">&quot;statistics 159/259 fall 2018&quot;</span>
<span class="n">prng</span> <span class="o">=</span> <span class="n">cr</span><span class="o">.</span><span class="n">SHA256</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fn</span> <span class="o">=</span> <span class="s1">&#39;../Data/karp_farms.csv&#39;</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
    <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">csvfile</span><span class="p">)</span>
    <span class="n">farms</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># what are the column names?</span>
<span class="n">farms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>odict_keys([&#39;Farm ID&#39;, &#39;county&#39;, &#39;town&#39;, &#39;E_Coli_Change&#39;, &#39;Salm_Change&#39;, &#39;Change in Nature&#39;, &#39;Change in Riparian&#39;, &#39;Change in Crop&#39;])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ecoli</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;E_Coli_Change&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">farms</span><span class="p">])</span>     <span class="c1"># the change in E coli </span>
<span class="n">nature</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;Change in Nature&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">farms</span><span class="p">])</span> <span class="c1"># the change in natural vegetation</span>

<span class="c1"># values for regression line plot</span>
<span class="n">nature_line</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">nature</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">nature</span><span class="p">),</span> <span class="n">num</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

<span class="c1"># augment data with a vector of 1s for regression with an intercept</span>
<span class="n">nature1</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">nature</span><span class="p">)</span>  
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">ecoli</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-0.003921569
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">do_regress</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="n">regress</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>  <span class="c1"># fit the linear regression model using OLS</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">regress</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
    <span class="n">coeffs</span> <span class="o">=</span> <span class="n">regress</span><span class="o">.</span><span class="n">params</span>                 <span class="c1"># coeffs[0] is the intercept; coeffs[1] is the slope</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">y</span><span class="p">,</span>  <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>                   <span class="c1"># data</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">nature_line</span><span class="p">,</span> <span class="n">coeffs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">coeffs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">nature_line</span><span class="p">)</span>  <span class="c1"># regression line</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Relative change in natural vegetation&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Relative change in EHEC&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span><span class="p">(</span><span class="n">coeffs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">coeffs</span><span class="o">=</span> <span class="n">do_regress</span><span class="p">(</span><span class="n">ecoli</span><span class="p">,</span> <span class="n">nature1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                      y   R-squared:                       0.299
Model:                            OLS   Adj. R-squared:                  0.272
Method:                 Least Squares   F-statistic:                     11.08
Date:                Sun, 16 Sep 2018   Prob (F-statistic):            0.00262
Time:                        20:37:19   Log-Likelihood:                 57.716
No. Observations:                  28   AIC:                            -111.4
Df Residuals:                      26   BIC:                            -108.8
Df Model:                           1                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
const          0.0033      0.007      0.492      0.627      -0.011       0.017
x1            -0.3036      0.091     -3.328      0.003      -0.491      -0.116
==============================================================================
Omnibus:                       27.451   Durbin-Watson:                   2.072
Prob(Omnibus):                  0.000   Jarque-Bera (JB):               78.562
Skew:                           1.760   Prob(JB):                     8.72e-18
Kurtosis:                      10.413   Cond. No.                         15.1
==============================================================================

Warnings:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
</pre></div>
</div>
<img alt="../_images/karpEtal15_7_1.png" src="../_images/karpEtal15_7_1.png" />
</div>
</div>
<p>Look at the coefficient lines in the regression output:</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>==============================================================================
               coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
const          0.0033      0.007      0.492      0.627      -0.011       0.017
x1            -0.3036      0.091     -3.328      0.003      -0.491      -0.116
</pre></div>
</div>
</div></blockquote>
<p>We are interested in the slope, x1, which is summarized in the bottom row.</p>
<p>The least-squares estimate of x1 is coef=-0.3036.
This value can be calculated provided the design matrix <span class="math notranslate nohighlight">\(X\)</span> has full rank (so that <span class="math notranslate nohighlight">\(X^TX\)</span> is invertible).
The estimate is unbiased if the model <span class="math notranslate nohighlight">\(Y = X\beta + \epsilon\)</span> is true, with <span class="math notranslate nohighlight">\(\mathbb{E} \epsilon = 0\)</span>.</p>
<p>The standard error 0.091 can be calculated provided <span class="math notranslate nohighlight">\(X\)</span> has full rank and <span class="math notranslate nohighlight">\(n &gt; p\)</span> (the number of data is greater than the number of parameters). But it is “really” an estimate of the standard error of the estimated slope only if the model is true, <span class="math notranslate nohighlight">\(X\)</span> is full rank, <span class="math notranslate nohighlight">\(n &gt; p\)</span>, <span class="math notranslate nohighlight">\(\mathbb{E}\epsilon = 0\)</span>, and <span class="math notranslate nohighlight">\(\mathrm{cov} \epsilon = \sigma^2 I_{n}\)</span>.</p>
<p>The t statistic -3.328 can be computed whenever coef and std err can be computed.
But the p-value, P&gt;|t|, is correct only if the model is true, <span class="math notranslate nohighlight">\(X\)</span> has full rank, <span class="math notranslate nohighlight">\(n &gt; p\)</span>, and <span class="math notranslate nohighlight">\(\epsilon \sim N(0, \sigma^2 I_n)\)</span>.
The same is true for the confidence interval.</p>
</div>
</div>
<div class="section" id="significance-of-the-slope">
<h1>Significance of the slope<a class="headerlink" href="#significance-of-the-slope" title="Permalink to this headline">¶</a></h1>
<div class="section" id="standard-regression-model">
<h2>Standard regression model<a class="headerlink" href="#standard-regression-model" title="Permalink to this headline">¶</a></h2>
<p>The “usual” regression model says <span class="math notranslate nohighlight">\(Y = X\beta + \epsilon\)</span>, where</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}  X = \left [ \begin{array}{ccccc} X_{11} &amp; X_{12} &amp; \cdots &amp; X_{1p} \\ 
                X_{21} &amp; X_{22} &amp; \cdots &amp; X_{2p} \\
                \vdots &amp; \vdots &amp; \vdots &amp; \vdots \\ 
                X_{n1} &amp; X_{n2} &amp; \cdots &amp; X_{np} \end{array} \right ]\end{equation*}\]</div>
<p>is the <em>design matrix</em>, <span class="math notranslate nohighlight">\(\beta = [\beta_1 \beta_2 \cdots \beta_p]^T\)</span> are the <em>coefficients</em>, <span class="math notranslate nohighlight">\(\epsilon = [\epsilon_1 , \ldots, \epsilon_n]^T\)</span> is the <em>noise</em> or <em>random error</em>, and it is assumed that
<span class="math notranslate nohighlight">\(\{ \epsilon_j \}_{j=1}^n\)</span> are IID with mean zero and variance <span class="math notranslate nohighlight">\(\sigma^2\)</span>.
We assume that <span class="math notranslate nohighlight">\(X\)</span> is full rank <span class="math notranslate nohighlight">\(p\)</span> and either that <span class="math notranslate nohighlight">\(X\)</span> is not random or that <span class="math notranslate nohighlight">\(X\)</span> and <span class="math notranslate nohighlight">\(\epsilon\)</span> are independent, in which case we will condition on <span class="math notranslate nohighlight">\(X\)</span>.
We also assume <span class="math notranslate nohighlight">\(n &gt; p\)</span>.</p>
<p>The OLS estimate is <span class="math notranslate nohighlight">\(\hat{\beta} \equiv (X^TX)^{-1}X^T Y\)</span>.</p>
<div class="section" id="theorem-the-ols-estimate-is-unbiased-and-mathrm-cov-hat-beta-x-tx-1-x-t-mathrm-cov-epsilon-x-x-x-tx-1">
<h3>Theorem: the OLS estimate is unbiased and <span class="math notranslate nohighlight">\(\mathrm{cov}(\hat{\beta}) = (X^TX)^{-1} X^T \mathrm{cov}(\epsilon | X) X (X^TX)^{-1}\)</span>.<a class="headerlink" href="#theorem-the-ols-estimate-is-unbiased-and-mathrm-cov-hat-beta-x-tx-1-x-t-mathrm-cov-epsilon-x-x-x-tx-1" title="Permalink to this headline">¶</a></h3>
<p><strong>Proof.</strong></p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}  (X^TX)^{-1}X^T Y = (X^TX)^{-1}X^T (X\beta + \epsilon) = (X^TX)^{-1}X^TX\beta + (X^TX)^{-1}X^T\epsilon \end{equation*}\]</div>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}  = \beta + (X^TX)^{-1}X^T\epsilon.\end{equation*}\]</div>
<p>Now,</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*} \mathbb{E} \left (\beta + (X^TX)^{-1}X^T\epsilon | X \right ) = \beta + (X^TX)^{-1}X^T \mathbb{E} (\epsilon | X)\end{equation*}\]</div>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}  = \beta + (X^TX)^{-1}X^T \mathbf{0} = \beta,\end{equation*}\]</div>
<p>so <span class="math notranslate nohighlight">\(\hat{\beta}\)</span> is unbiased.</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}  \mathrm{cov} \left (\hat{\beta} | X \right ) \equiv \mathbb{E} ((\hat{\beta} - \beta)(\hat{\beta} - \beta)^T | X) \end{equation*}\]</div>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}  = \mathbb{E} \left ( (X^TX)^{-1}X^T \epsilon ((X^TX)^{-1}X^T \epsilon)^T | X \right ) \end{equation*}\]</div>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}  = \mathbb{E} \left ( (X^TX)^{-1}X^T \epsilon \epsilon^T X (X^TX)^{-1} | X \right ) \end{equation*}\]</div>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}  = (X^TX)^{-1}X^T \mathbb{E}(\epsilon \epsilon^T | X) X (X^TX)^{-1}\end{equation*}\]</div>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}  = (X^TX)^{-1}X^T \mathrm{cov}(\epsilon | X) X (X^TX)^{-1}.\end{equation*}\]</div>
<p>Since <span class="math notranslate nohighlight">\(\mathrm{cov}(\epsilon | X) = \sigma^2 I_{n}\)</span>, this simplifies to</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}  \mathrm{cov} (\hat{\beta} | X) = \sigma^2 (X^TX)^{-1}X^T I_n X (X^TX)^{-1} = \sigma^2 (X^TX)^{-1}.\end{equation*}\]</div>
<p>Define <span class="math notranslate nohighlight">\(e = Y - X \hat{\beta}\)</span>, the <em>residuals</em>.</p>
<p>A conditionally unbiased estimate for <span class="math notranslate nohighlight">\(\sigma^2\)</span> is</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}  \hat{\sigma}^2 = \frac{1}{n-p} \sum_{j=1}^n e_j^2 = \frac{1}{n-p} \sum_{j=1}^n (Y_j - X_j \hat{\beta})^2.\end{equation*}\]</div>
</div>
<div class="section" id="the-t-test">
<h3>The t-test<a class="headerlink" href="#the-t-test" title="Permalink to this headline">¶</a></h3>
<p>The <span class="math notranslate nohighlight">\(t\)</span>-test for whether a coefficient is significantly different from zero requires the further assumption that
<span class="math notranslate nohighlight">\(\{ \epsilon_j \}\)</span> have a distribution that is jointly normal (given <span class="math notranslate nohighlight">\(X\)</span>):  given <span class="math notranslate nohighlight">\(X\)</span>, <span class="math notranslate nohighlight">\(\{ \epsilon_j \}\)</span> are IID <span class="math notranslate nohighlight">\(N(0, \sigma^2)\)</span>.</p>
<p>Then <span class="math notranslate nohighlight">\(\hat{\beta} \sim N(\beta, \sigma^2 (X^TX)^{-1})\)</span>.</p>
<p>The <span class="math notranslate nohighlight">\(t\)</span> statistic for the <span class="math notranslate nohighlight">\(\hat{\beta}_k\)</span> is</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}  t = \hat{\beta}_k/\hat{\mathrm{SE}}_k, \end{equation*}\]</div>
<p>where <span class="math notranslate nohighlight">\(\hat{\mathrm{SE}}_k \equiv \hat{\sigma} \sqrt{(X^TX)^{-1}_{kk}}\)</span>.</p>
<p>Under all the assumptions, <span class="math notranslate nohighlight">\(t\)</span> has Student’s <span class="math notranslate nohighlight">\(t\)</span> distribution with <span class="math notranslate nohighlight">\(n-p\)</span> degrees of freedom if <span class="math notranslate nohighlight">\(\beta_k = 0\)</span>.</p>
</div>
</div>
<div class="section" id="permutation-test">
<h2>Permutation test<a class="headerlink" href="#permutation-test" title="Permalink to this headline">¶</a></h2>
<p>Because the assumptions that lead to the t-test are unreasonable in this application, we will look at other ways of assessing the evidence that the two variables are associated.</p>
<p>Let’s specialize to the case <span class="math notranslate nohighlight">\(p = 2\)</span>, with <span class="math notranslate nohighlight">\(X_{k1} = 1\)</span> (an intercept term in the regression).</p>
<p>Suppose that the components of <span class="math notranslate nohighlight">\(\epsilon\)</span> are IID (but not necessarily zero mean, normal, or anything else). Under the hypothesis that <span class="math notranslate nohighlight">\(\beta_1 = 0\)</span>, the data are then</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}  Y_j = \beta_0 + 0\times X_j + \epsilon_j = \beta_0 + \epsilon_j, \;\; j=1, \ldots, n.\end{equation*}\]</div>
<p>Since <span class="math notranslate nohighlight">\(\{ \epsilon_j \}\)</span> are IID, so are <span class="math notranslate nohighlight">\(\{ Y_j = \beta_0 + \epsilon_j \}\)</span>.</p>
<p><strong>Definition.</strong> A set of random variables <span class="math notranslate nohighlight">\(\{Z_j \}_{j=1}^n\)</span> is <em>exchangeable</em> if the joint distribution of <span class="math notranslate nohighlight">\((Z_{\pi_1}, Z_{\pi_2}, \ldots, Z_{\pi_n})\)</span> is the same for all permutations <span class="math notranslate nohighlight">\(\pi\)</span> of <span class="math notranslate nohighlight">\(\{1, 2, \ldots, n\}\)</span>.</p>
<p>If a set of variables is IID, it is exchangeable. (The converse is not necessarily true.)</p>
<p>Thus if <span class="math notranslate nohighlight">\(\beta_1 = 0\)</span>, <span class="math notranslate nohighlight">\(\{Y_j \}_{j=1}^n\)</span> are exchangeable.</p>
<p>Suppose <span class="math notranslate nohighlight">\(\{Z_j \}_{j=1}^n\)</span> are exchangeable, and let <span class="math notranslate nohighlight">\(z \in \Re^n\)</span>.
Then for every permutation <span class="math notranslate nohighlight">\(\pi\)</span> of <span class="math notranslate nohighlight">\(\{1, \ldots, n \}\)</span>,</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*} \Pr \{ Z_j = z_j, j=1, \ldots, n \} = \Pr \{ Z_j = z_{\pi_j}, j = 1, \ldots, n \}.\end{equation*}\]</div>
<p>Let <span class="math notranslate nohighlight">\(z = (z_1, \ldots, z_n)\)</span>.
The set of all <span class="math notranslate nohighlight">\((z_{\pi_j})_{j=1}^n\)</span> for all permutations <span class="math notranslate nohighlight">\(\pi\)</span> of <span class="math notranslate nohighlight">\(\{1, \ldots, n \}\)</span> is <em>the orbit of <span class="math notranslate nohighlight">\(z\)</span> under the permutation group</em>.</p>
<div class="section" id="what-s-the-justification-for-this-model-here">
<h3>What’s the justification for <em>this</em> model here?<a class="headerlink" href="#what-s-the-justification-for-this-model-here" title="Permalink to this headline">¶</a></h3>
<p>Why linear? Why additive errors? Why IID errors?</p>
</div>
<div class="section" id="another-approach-the-neyman-ticket-model">
<h3>Another approach: the Neyman “ticket” model<a class="headerlink" href="#another-approach-the-neyman-ticket-model" title="Permalink to this headline">¶</a></h3>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:center head"><p>item</p></th>
<th class="text-align:center head"><p>response if assigned <span class="math notranslate nohighlight">\(X_1\)</span></p></th>
<th class="text-align:center head"><p><span class="math notranslate nohighlight">\(\cdots\)</span></p></th>
<th class="text-align:center head"><p>response if assigned <span class="math notranslate nohighlight">\(X_n\)</span></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:center"><p>1</p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(Y_{11}\)</span></p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(\cdots\)</span></p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(Y_{1n}\)</span></p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p><span class="math notranslate nohighlight">\(\vdots\)</span></p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(\vdots\)</span></p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(\vdots\)</span></p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(\vdots\)</span></p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p><span class="math notranslate nohighlight">\(n\)</span></p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(Y_{n1}\)</span></p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(\cdots\)</span></p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(Y_{nn}\)</span></p></td>
</tr>
</tbody>
</table>
<p>Suppose there’s no connection between <span class="math notranslate nohighlight">\(X\)</span> and <span class="math notranslate nohighlight">\(Y\)</span>: response of item <span class="math notranslate nohighlight">\(j\)</span> would be the same, regardless of
the value of <span class="math notranslate nohighlight">\(X_i\)</span>.
Then all “shufflings” of <span class="math notranslate nohighlight">\(Y\)</span> versus <span class="math notranslate nohighlight">\(X\)</span> would be equally likely;
treat the data as if the treatment were assigned at random to the farm.</p>
<p>Is that more plausible or less plausible than the regression models?</p>
<p>Leads to exactly the same permutation test as <span class="math notranslate nohighlight">\(Y = X\beta + \epsilon\)</span> with
the components of <span class="math notranslate nohighlight">\(\epsilon\)</span> IID.</p>
<p>Why use <span class="math notranslate nohighlight">\(|\hat{\beta}_1|\)</span> as the test statistic?</p>
<p>Equivalent to a permutation test based on the Pearson correlation:</p>
<p><span class="math notranslate nohighlight">\(\hat{\beta}_1 = r \mathrm{SD}(Y)/\mathrm{SD}(X)\)</span>, where <span class="math notranslate nohighlight">\(r\)</span> is the (sample) correlation between <span class="math notranslate nohighlight">\(X\)</span> and <span class="math notranslate nohighlight">\(Y\)</span>.</p>
<p>One-to-one, monotonic relationship between them, so reject the null for exactly the
same data sets.</p>
</div>
</div>
</div>
<div class="section" id="how-to-shuffle">
<h1>How to shuffle<a class="headerlink" href="#how-to-shuffle" title="Permalink to this headline">¶</a></h1>
<ol class="simple">
<li><p>Assign a pseudo-random number to every element, then sort based on that number</p></li>
<li><p>Fisher-Yates-Knuth-Durstenfeld shuffle</p></li>
</ol>
<p><strong>Algorithm Fisher-Yates-Knuth-Durstenfeld shuffle (backwards version)</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>for i=1, ..., n-1:
    J &lt;- random integer uniformly distributed on {i, ..., n}
    (a[J], a[i]) &lt;- (a[i], a[J])
</pre></div>
</div>
<p>This requires the ability to generate independent random integers on various ranges. Doesn’t require sorting.</p>
<p>There’s a version suitable for streaming, i.e., generating a random permutation of a list that has an (initially) unknown number  nn of elements:</p>
<p><strong>Algorithm Fisher-Yates-Knuth-Durstenfeld shuffle (streaming version)</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>i &lt;- 0
a = []
while there are records left:
    i &lt;- i+1
    J &lt;- random integer uniformly distributed on {1, ..., i}
    if J &lt; i:
        a[i] &lt;- a[J]
        a[J] &lt;- next record
    else:
        a[i] &lt;- next record
</pre></div>
</div>
<p>Again, need to be able to generate independent uniformly distributed random integers.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">fykd</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">gen</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">J</span> <span class="o">=</span> <span class="n">gen</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
        <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="n">J</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">J</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">return</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="proof-that-the-streaming-fisher-yates-knuth-durstenfeld-algorithm-works">
<h2>Proof that the streaming Fisher-Yates-Knuth-Durstenfeld algorithm works<a class="headerlink" href="#proof-that-the-streaming-fisher-yates-knuth-durstenfeld-algorithm-works" title="Permalink to this headline">¶</a></h2>
<p>Induction:</p>
<p>For <span class="math notranslate nohighlight">\(i=1\)</span>, obvious.</p>
<p>At stage <span class="math notranslate nohighlight">\(i\)</span>, suppose all <span class="math notranslate nohighlight">\(i!\)</span> permutations are equally likely. For each such permutation, there are
<span class="math notranslate nohighlight">\(i+1\)</span> distinct, equally likely permutations at stage <span class="math notranslate nohighlight">\(i+1\)</span>, resulting from swapping the <span class="math notranslate nohighlight">\(i+1\)</span>st item with one
of the first <span class="math notranslate nohighlight">\(i\)</span>, or putting it in position <span class="math notranslate nohighlight">\(i+1\)</span>. These possibilities are mutually exclusive of
the permutations attainable from a different permutation of the first <span class="math notranslate nohighlight">\(i\)</span> items.</p>
<p>Thus, this enumerates all <span class="math notranslate nohighlight">\((i+1)i! = (i+1)!\)</span> permutations of <span class="math notranslate nohighlight">\((i+1)\)</span> items, and they are equally likely. ■</p>
</div>
</div>
<div class="section" id="how-not-to-shuffle">
<h1>How not to shuffle<a class="headerlink" href="#how-not-to-shuffle" title="Permalink to this headline">¶</a></h1>
<p>Sort using a “random” comparison function, e.g.,</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>def RandomSort(a,b):
    return (0.5 - np.random.random())
</pre></div>
</div>
<p>But this fails the basic properties of an ordering, e.g., transitivity, reflexiveness, etc. Doesn’t produce random permutation. Output also depends on sorting algorithm.</p>
<p>Notoriously used by Microsoft to offer a selection of browsers in the EU. Resulted in IE being 5th of 5 about half the time in IE and about 26% of the time in Chrome, but only 6% of the time in Safari (4th about 40% of the time).</p>
<p>See, e.g., http://www.computerworld.com/article/2520190/web-apps/microsoft-s-eu-ballot-fails-to-randomize-browser-order.html</p>
</div>
<div class="section" id="how-to-generate-random-integers">
<h1>How to generate random integers<a class="headerlink" href="#how-to-generate-random-integers" title="Permalink to this headline">¶</a></h1>
<p>Textbook approach:</p>
<p>To generate a random integer between 0 and m-1</p>
<ul class="simple">
<li><p>Generate <span class="math notranslate nohighlight">\(U \sim U[0, 1)\)</span></p></li>
<li><p>Return <span class="math notranslate nohighlight">\(\lfloor mU \rfloor\)</span></p></li>
</ul>
<p>Works if <span class="math notranslate nohighlight">\(U\)</span> <em>really were</em> <span class="math notranslate nohighlight">\(U[0, 1)\)</span>, but that’s not what PRNGs generate. Instead, typically generate a <span class="math notranslate nohighlight">\(k\)</span>-bit binary fraction (or its floating-point representation).</p>
<p>Introduces truncation effects. Even if the PRNG were perfectly uniform on its output, result would be uniformly distributed on <span class="math notranslate nohighlight">\(\{0, 1, \ldots, m-1\}\)</span> only if <span class="math notranslate nohighlight">\(m\)</span> is a power of 2 (not exceeding the number of bits of output of the PRNG).</p>
<p>Better approach (used in python):</p>
<p>Let <span class="math notranslate nohighlight">\(k = \lceil \log_2(m-1) \rceil\)</span>. Generate <span class="math notranslate nohighlight">\(k\)</span> random bits and interpret the result <span class="math notranslate nohighlight">\(M\)</span> as an integer. If <span class="math notranslate nohighlight">\(M \le m-1\)</span>, return <span class="math notranslate nohighlight">\(M\)</span>. Otherwise, generate <span class="math notranslate nohighlight">\(k\)</span> more random bits and try again.</p>
<p>See <a class="reference external" href="https://github.com/statlab/cryptorandom/blob/master/cryptorandom/cryptorandom.py">cryptorandom</a></p>
<div class="section" id="how-r-generates-random-integers">
<h2>How R generates random integers<a class="headerlink" href="#how-r-generates-random-integers" title="Permalink to this headline">¶</a></h2>
<p>R uses a variant of the floor approach, but uses floating-point numbers at an intermediate step.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use cryptorandom&#39;s permutation</span>
<span class="k">def</span> <span class="nf">permute_regress</span><span class="p">(</span><span class="n">ec</span><span class="p">,</span> <span class="n">nat</span><span class="p">,</span> <span class="n">reps</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">5</span><span class="p">)):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Permutation distribution of OLS estimate of slope, regressing ec on nat</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">reps</span><span class="p">)</span>                                         <span class="c1"># allocate storage for slope estimates</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">reps</span><span class="p">):</span>
        <span class="n">permutation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sample</span><span class="o">.</span><span class="n">fykd_sample</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ec</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">ec</span><span class="p">),</span> <span class="n">gen</span><span class="o">=</span><span class="n">prng</span><span class="p">))</span><span class="o">-</span><span class="mi">1</span>  <span class="c1"># shuffle indices</span>
        <span class="n">p_ec</span> <span class="o">=</span> <span class="n">ec</span><span class="p">[</span><span class="n">permutation</span><span class="p">]</span>                                    <span class="c1"># permute the E coli values</span>
        <span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">p_ec</span><span class="p">,</span> <span class="n">nat</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>               <span class="c1"># regress</span>
    <span class="k">return</span> <span class="n">vals</span>

<span class="k">def</span> <span class="nf">p_CI</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">t</span><span class="p">):</span> 
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    estimated probability that |v| &gt;= t based on independent trials,</span>
<span class="sd">    and upper confidence bound for the true probability</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">exceed</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">t</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;estimated p:&quot;</span><span class="p">,</span> <span class="n">exceed</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">binom_conf_interval</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">),</span><span class="n">x</span><span class="o">=</span><span class="n">exceed</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s1">&#39;upper&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vals</span> <span class="o">=</span> <span class="n">permute_regress</span><span class="p">(</span><span class="n">ecoli</span><span class="p">,</span> <span class="n">nature1</span><span class="p">)</span>
<span class="n">p_CI</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">coeffs</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>estimated p: 0.03099 (0.0, 0.032082742274273775)
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="sensitivity-to-farm-31">
<h1>Sensitivity to farm 31<a class="headerlink" href="#sensitivity-to-farm-31" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ecoli_edit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;E_Coli_Change&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">farms</span> <span class="k">if</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;Farm ID&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;31&#39;</span><span class="p">])</span>     <span class="c1"># omit farm 31</span>
<span class="n">nature_edit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;Change in Nature&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">farms</span> <span class="k">if</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;Farm ID&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;31&#39;</span><span class="p">])</span> <span class="c1"># omit farm 31</span>
<span class="n">nature_edit1</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">nature_edit</span><span class="p">)</span>    <span class="c1"># add intercept</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">coeffs_edit</span> <span class="o">=</span> <span class="n">do_regress</span><span class="p">(</span><span class="n">ecoli_edit</span><span class="p">,</span> <span class="n">nature_edit1</span><span class="p">)</span>
<span class="n">vals</span> <span class="o">=</span> <span class="n">permute_regress</span><span class="p">(</span><span class="n">ecoli_edit</span><span class="p">,</span> <span class="n">nature_edit1</span><span class="p">)</span> <span class="c1"># permutation distribution of estimated slope</span>
<span class="n">p_CI</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">coeffs_edit</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                      y   R-squared:                       0.059
Model:                            OLS   Adj. R-squared:                  0.021
Method:                 Least Squares   F-statistic:                     1.562
Date:                Sun, 16 Sep 2018   Prob (F-statistic):              0.223
Time:                        20:37:57   Log-Likelihood:                 75.457
No. Observations:                  27   AIC:                            -146.9
Df Residuals:                      25   BIC:                            -144.3
Df Model:                           1                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
const          0.0054      0.003      1.645      0.113      -0.001       0.012
x1            -0.0635      0.051     -1.250      0.223      -0.168       0.041
==============================================================================
Omnibus:                       45.099   Durbin-Watson:                   2.175
Prob(Omnibus):                  0.000   Jarque-Bera (JB):              188.313
Skew:                           3.230   Prob(JB):                     1.28e-41
Kurtosis:                      14.210   Cond. No.                         17.2
==============================================================================

Warnings:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
</pre></div>
</div>
<img alt="../_images/karpEtal15_21_1.png" src="../_images/karpEtal15_21_1.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>estimated p: 0.11594 (0.0, 0.11794043933579963)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="fourth-root-transformation">
<h1>Fourth-root transformation<a class="headerlink" href="#fourth-root-transformation" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Karp et al. use fourth-root transformation of the contamination data.</span>

<span class="n">ecoli4th</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">ecoli</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ecoli</span><span class="p">),</span> <span class="mi">1</span><span class="o">/</span><span class="mi">4</span><span class="p">))</span>   <span class="c1"># signed fourth root</span>
<span class="n">coeffs4th</span> <span class="o">=</span> <span class="n">do_regress</span><span class="p">(</span><span class="n">ecoli4th</span><span class="p">,</span> <span class="n">nature1</span><span class="p">)</span>                              <span class="c1"># reference estimates</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                      y   R-squared:                       0.254
Model:                            OLS   Adj. R-squared:                  0.226
Method:                 Least Squares   F-statistic:                     8.873
Date:                Sun, 16 Sep 2018   Prob (F-statistic):            0.00620
Time:                        20:38:39   Log-Likelihood:                 9.3891
No. Observations:                  28   AIC:                            -14.78
Df Residuals:                      26   BIC:                            -12.11
Df Model:                           1                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
const          0.1275      0.038      3.348      0.002       0.049       0.206
x1            -1.5264      0.512     -2.979      0.006      -2.580      -0.473
==============================================================================
Omnibus:                        1.056   Durbin-Watson:                   1.957
Prob(Omnibus):                  0.590   Jarque-Bera (JB):                0.995
Skew:                          -0.407   Prob(JB):                        0.608
Kurtosis:                       2.563   Cond. No.                         15.1
==============================================================================

Warnings:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
</pre></div>
</div>
<img alt="../_images/karpEtal15_23_1.png" src="../_images/karpEtal15_23_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># simulated p-value</span>
<span class="n">vals</span> <span class="o">=</span> <span class="n">permute_regress</span><span class="p">(</span><span class="n">ecoli4th</span><span class="p">,</span> <span class="n">nature1</span><span class="p">)</span> <span class="c1"># permutation distribution of estimated slope</span>
<span class="n">p_CI</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">coeffs4th</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>estimated p: 0.00672 (0.0, 0.007245947095395319)
</pre></div>
</div>
</div>
</div>
<div class="section" id="th-root-without-farm-31">
<h2>4th root without farm 31<a class="headerlink" href="#th-root-without-farm-31" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Sensitivity to farm 31</span>
<span class="n">ecoli4th_edit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;E_Coli_Change&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">farms</span> <span class="k">if</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;Farm ID&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;31&#39;</span><span class="p">])</span> <span class="c1"># omit farm 31</span>
<span class="n">ecoli4th_edit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">ecoli4th_edit</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ecoli4th_edit</span><span class="p">),</span> <span class="mi">1</span><span class="o">/</span><span class="mi">4</span><span class="p">))</span>    <span class="c1"># signed 4th root</span>
<span class="n">coeffs4th_edit</span> <span class="o">=</span> <span class="n">do_regress</span><span class="p">(</span><span class="n">ecoli4th_edit</span><span class="p">,</span> <span class="n">nature_edit1</span><span class="p">)</span>           <span class="c1"># reference coefficients</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                      y   R-squared:                       0.126
Model:                            OLS   Adj. R-squared:                  0.091
Method:                 Least Squares   F-statistic:                     3.599
Date:                Sun, 16 Sep 2018   Prob (F-statistic):             0.0694
Time:                        20:39:20   Log-Likelihood:                 9.6339
No. Observations:                  27   AIC:                            -15.27
Df Residuals:                      25   BIC:                            -12.68
Df Model:                           1                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
const          0.1311      0.037      3.504      0.002       0.054       0.208
x1            -1.1041      0.582     -1.897      0.069      -2.303       0.095
==============================================================================
Omnibus:                        0.695   Durbin-Watson:                   1.912
Prob(Omnibus):                  0.707   Jarque-Bera (JB):                0.587
Skew:                          -0.332   Prob(JB):                        0.746
Kurtosis:                       2.716   Cond. No.                         17.2
==============================================================================

Warnings:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
</pre></div>
</div>
<img alt="../_images/karpEtal15_26_1.png" src="../_images/karpEtal15_26_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># simulated p-value</span>
<span class="n">vals</span> <span class="o">=</span> <span class="n">permute_regress</span><span class="p">(</span><span class="n">ecoli4th_edit</span><span class="p">,</span> <span class="n">nature_edit1</span><span class="p">)</span>  <span class="c1"># permutation distribution of estimated slope</span>
<span class="n">p_CI</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">coeffs4th_edit</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>estimated p: 0.06815 (0.0, 0.0697294654933772)
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="questions">
<h1>Questions:<a class="headerlink" href="#questions" title="Permalink to this headline">¶</a></h1>
<ol class="simple">
<li><p>How did Karp et al. decide to use the 4th-root transformation?</p></li>
<li><p>What is the effect of using that transformation?</p></li>
<li><p>How many other transformations were considered or tried? Does the article say?</p></li>
<li><p>What effect does testing for normality and trying different transformations have on the p-value?</p></li>
</ol>
<p>Gelman and Loken, 2013: <a class="reference external" href="http://www.stat.columbia.edu/~gelman/research/unpublished/p_hacking.pdf">“Garden of Forking Paths”</a></p>
</div>
<div class="section" id="technical-issues">
<h1>Technical issues:<a class="headerlink" href="#technical-issues" title="Permalink to this headline">¶</a></h1>
<ol class="simple">
<li><p>Formally, <span class="math notranslate nohighlight">\(\hat{\beta} = (X^TX)^{-1}X^TY\)</span>, but that’s not how to compute it. Why?</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> version_information
<span class="o">%</span><span class="k">version_information</span> scipy, numpy, pandas, matplotlib, notebook, jupyter
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Loading extensions from ~/.ipython/extensions is deprecated. We recommend managing extensions like any other Python packages, in site-packages.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/anaconda/lib/python3.6/site-packages/IPython/core/formatters.py:839: FormatterWarning: JSON expects JSONable list/dict containers, not JSON strings
  FormatterWarning)
</pre></div>
</div>
<div class="output text_html"><table><tr><th>Software</th><th>Version</th></tr><tr><td>Python</td><td>3.6.1 64bit [GCC 4.2.1 Compatible Apple LLVM 6.0 (clang-600.0.57)]</td></tr><tr><td>IPython</td><td>6.4.0</td></tr><tr><td>OS</td><td>Darwin 17.7.0 x86_64 i386 64bit</td></tr><tr><td>scipy</td><td>1.1.0</td></tr><tr><td>numpy</td><td>1.14.5</td></tr><tr><td>pandas</td><td>0.23.1</td></tr><tr><td>matplotlib</td><td>2.2.2</td></tr><tr><td>notebook</td><td>5.5.0</td></tr><tr><td>jupyter</td><td>1.0.0</td></tr><tr><td colspan='2'>Sun Sep 16 20:40:01 2018 PDT</td></tr></table></div></div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./Notes"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Philip Stark and Fernando Pérez<br/>
  
      &copy; Copyright 2021.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>
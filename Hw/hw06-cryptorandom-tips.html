
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Some tips for HW06 &#8212; Collaborative and Reproducible Data Science</title>
    
  <link rel="stylesheet" href="../_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.e7340bb3dbd8dde6db86f25597f54a1b.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.7d483ff0a819d6edff12ce0b1ead3928.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Collaborative and Reproducible Data Science</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../overview.html">
   Statistics 159/259, Spring 2021 Course Summary
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Overview
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../schedule.html">
   Statistics 159/259: Weekly Plan
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Syllabus
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../syllabus.html">
   Syllabus for Statistics 159/259: Reproducible and Collaborative Statistical Data Science
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Homework Assignments
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="hw01-background.html">
   1. Homework 1. Stats review and intro to Git
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="hw02-election-fraud.html">
   2. Homework 2. Election Fraud
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="hw03-testing.html">
   3. Homework 3: Coding style, docstrings, algorithmic choices, and unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="hw04-phil-sci-covid.html">
   4. Homework 4: Reproducibility, Philosophy of Science, and COVID-19 Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="hw05-selection-outliers.html">
   5. Homework 5: Selective inference and outlier rejection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="hw06-cryptorandom-contrib.html">
   6. Homework 6: Cryptorandom - contributing to an open source project
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Lecture Notes
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../Notes/index.html">
   An Idiosyncratic Sample of Applied Statistics
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Lecture Index
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../Index/index.html">
   Index of Lectures and Materials
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/Hw/hw06-cryptorandom-tips.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->


            <!-- Full screen (wrap in <a> to have style consistency -->
            <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                    data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                    title="Fullscreen mode"><i
                        class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/Hw/hw06-cryptorandom-tips.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i>
            Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#install-cryptorandom-locally-in-development-mode">
   Install
   <code class="docutils literal notranslate">
    <span class="pre">
     cryptorandom
    </span>
   </code>
   locally in development mode
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#set-up-the-sphinx-build-for-jupyterhub-hosted-viewing">
   Set up the Sphinx build for JupyterHub-hosted viewing
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#editing-the-docs-and-testing-your-build">
   Editing the docs and testing your build
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#development-workfow">
   Development workfow
  </a>
 </li>
</ul>

        </nav>
        
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="some-tips-for-hw06">
<h1>Some tips for HW06<a class="headerlink" href="#some-tips-for-hw06" title="Permalink to this headline">¶</a></h1>
<p>These notes should help you work through some of the issues we discussed in lecture today, regarding how to render the sphinx documentation for <code class="docutils literal notranslate"><span class="pre">cryptorandom</span></code> in the hub, and how to then view your own build of these docs through the hub.</p>
<p>Basically we need to solve the following problems:</p>
<ol class="simple">
<li><p>We need to ensure that pytest, Sphinx and other tools find and use our in-development version of <code class="docutils literal notranslate"><span class="pre">cryptorandom</span></code> instead of the system-wide one, so our new work is reflected in the tests and documentation we create.</p></li>
<li><p>We need to be able to build the documentation on JupyterHub and view the resulting docs online easily, through the Hub.</p></li>
</ol>
<p>Credit and huge thanks to <a class="reference external" href="https://github.com/yuvipanda">Yuvi Panda</a> from the JupyterHub/Berkeley team for his help navigating the proxy issues detailed below.</p>
<div class="section" id="install-cryptorandom-locally-in-development-mode">
<h2>Install <code class="docutils literal notranslate"><span class="pre">cryptorandom</span></code> locally in development mode<a class="headerlink" href="#install-cryptorandom-locally-in-development-mode" title="Permalink to this headline">¶</a></h2>
<p>The first issue we must solve is for Sphinx to find the version of <code class="docutils literal notranslate"><span class="pre">cryptorandom</span></code> that you are working on, rather than the installed one. This manifests itself immediately as the <code class="docutils literal notranslate"><span class="pre">AttributeError</span></code> you see regarding a missing <code class="docutils literal notranslate"><span class="pre">__version__</span></code> attribute when trying to build the docs, but even if you fix that with a quick hack as I did in lecture, you’ll still have a problem. The issue is that the docs will import the <em>system-wide installed</em> version of <code class="docutils literal notranslate"><span class="pre">cryptorandom</span></code>, and not your local development copy. So any new docstrings or function signatures you edit will not be correctly reflected in the resulting docs.</p>
<p>The solution is to install your working copy as a <em>development version</em>, also known as an <em>“editable install”</em> (hence the <code class="docutils literal notranslate"><span class="pre">-e</span></code> command line argument, short for <code class="docutils literal notranslate"><span class="pre">--editable</span></code>). We now explain how to do this, and you can find more details in the <a class="reference external" href="https://pip.pypa.io/en/stable/reference/pip_install/#editable-installs">pip documentation</a>.</p>
<p>In the top-level of the <code class="docutils literal notranslate"><span class="pre">cryptorandom</span></code> directory, where the file <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> lives, run the command:</p>
<p><code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">-e</span> <span class="pre">.</span></code></p>
<p>You should see something like the following output (with your own user name in the path):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>jovyan@jupyter-fernando-2eperez:~/cryptorandom$ pip install -e .
Obtaining file:///home/jovyan/cryptorandom
Requirement already satisfied: numpy&gt;=1.20 in /opt/conda/lib/python3.8/site-packages (from cryptorandom==0.3rc2.dev0) (1.20.1)
Requirement already satisfied: scipy&gt;=1.6 in /opt/conda/lib/python3.8/site-packages (from cryptorandom==0.3rc2.dev0) (1.6.0)
Installing collected packages: cryptorandom
  Attempting uninstall: cryptorandom
    Found existing installation: cryptorandom 0.2
    Uninstalling cryptorandom-0.2:
      Successfully uninstalled cryptorandom-0.2
  Running setup.py develop for cryptorandom
Successfully installed cryptorandom
</pre></div>
</div>
<p>Check that you got it right by doing the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">doc</span><span class="o">/</span>
<span class="n">python</span> <span class="o">-</span><span class="n">c</span> <span class="s2">&quot;import cryptorandom as cr;print(cr.__version__)&quot;</span>
</pre></div>
</div>
<p>You should see:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>jovyan@jupyter-fernando-2eperez:~/cryptorandom$ cd doc/
jovyan@jupyter-fernando-2eperez:~/cryptorandom/doc$ python -c &quot;import cryptorandom as cr;print(cr.__version__)&quot;
0.3rc2.dev0
</pre></div>
</div>
</div>
<div class="section" id="set-up-the-sphinx-build-for-jupyterhub-hosted-viewing">
<h2>Set up the Sphinx build for JupyterHub-hosted viewing<a class="headerlink" href="#set-up-the-sphinx-build-for-jupyterhub-hosted-viewing" title="Permalink to this headline">¶</a></h2>
<p>Now we turn to the second problem: once we build our docs with Sphinx against our development version, how do we look at the built HTML results? These files are hosted in the Hub, not our home computer, so we can’t easily view them immediately. While JupyterLab can display individual HTML files, this will not show a fully styled version with all the necessary extra assets such as images, CSS, etc.  We need to use a full <em>web server</em> for that, and we need to be able to access that web server from outside the Hub. We now explain how to achieve this.</p>
<p>First, you need to make a change to <code class="docutils literal notranslate"><span class="pre">conf.py</span></code> so that the build can be seen through a JupyterHub installation. This change can probably go into cryptorandom proper in the end, but for now we suggest you make it directly into the team repo in a single commit, that all team members then pull from, so you all have it in one place. You need to add three lines below - the comment is there in the file already, around line 108, and we leave it here for ease of reference. You neeed to add the code starting with <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">os</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># -- Options for HTML output ----------------------------------------------</span>

<span class="kn">import</span> <span class="nn">os</span>

<span class="k">if</span> <span class="s2">&quot;JUPYTERHUB_SERVICE_PREFIX&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
    <span class="n">html_baseurl</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;JUPYTERHUB_SERVICE_PREFIX&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">/proxy/absolute/8000&#39;</span>
</pre></div>
</div>
<p>Just to make sure these changes apply everywhere, in the <code class="docutils literal notranslate"><span class="pre">doc/</span></code> directory run <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">clean</span></code> once after the above, and then continue with the below. In what follows you may want to keep at least <em>two</em> terminals open, one where you keep running the HTML Sphinx build, and one to run the server to check your builds (some might keep a third open in the top-level directory for git work, commits, pushes, etc). Take advantage of JupyterLab’s ability to lay them out in whatever way you find most visually convenient!</p>
<p>Once you make these changes you should commit and push them to the team repo, and all members need to ensure they pull from that correctly and they all have the same <code class="docutils literal notranslate"><span class="pre">conf.py</span></code>.</p>
</div>
<div class="section" id="editing-the-docs-and-testing-your-build">
<h2>Editing the docs and testing your build<a class="headerlink" href="#editing-the-docs-and-testing-your-build" title="Permalink to this headline">¶</a></h2>
<p>Make your edits and run <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">html</span></code> in the <code class="docutils literal notranslate"><span class="pre">doc/</span></code> directory.  To check your build, then go to your other terminal (if you chose to have more than one) and go to the <code class="docutils literal notranslate"><span class="pre">build/html</span></code> subdirectory. There, run:</p>
<p><code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-m</span> <span class="pre">http.server</span></code></p>
<p>as we saw today in class.  This will print a message like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>jovyan@jupyter-fernando-2eperez:~/cryptorandom/doc/build/html$ python -m http.server
Serving HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...
</pre></div>
</div>
<p>but you can <em>not</em> access <code class="docutils literal notranslate"><span class="pre">http://0.0.0.0:8000</span></code> as we explained today in class, as on your home computer that would correspond to a local port. Instead you need to reach that port but on the Stat159 DataHub!</p>
<p>In order to support that, the Hub runs what is called a proxy service, that basically hooks up port 8000 on the Hub service to a publicly available path on the internet, so that you can see that internal port from your home computer.</p>
<p>The file you are trying to reach is <code class="docutils literal notranslate"><span class="pre">index.html</span></code> at the <code class="docutils literal notranslate"><span class="pre">doc/build/html</span></code> directory, being served on port 8000 on the server. To access that file from home, instead you tell your laptop to go to:</p>
<p>https://stat159.datahub.berkeley.edu/user-redirect/proxy/8000/index.html</p>
<p>(if you had configured the python HTTP server to use a different port than 8000 you’d change that number, and similarly if the name of the file you wanted to look at was different you’d adjust the path).</p>
<p>That URL will automatically change to a different one, with your username, and should show you the build of the docs. This is what that looks like for me when it’s all running:</p>
<p><img alt="" src="../_images/hw06-sphinx-build-hub-proxy-view.png" /></p>
<p>As a side note, you may want to explore using <a class="reference external" href="https://github.com/executablebooks/sphinx-autobuild">sphinx-autobuild</a>, a tool that automatically builds and reloads your Sphinx docs as you make changes. I haven’t personally tested it yet but it looks interesting, it is developed by the same team from the Executable Books project that builds JupyterBook.</p>
</div>
<div class="section" id="development-workfow">
<h2>Development workfow<a class="headerlink" href="#development-workfow" title="Permalink to this headline">¶</a></h2>
<p>You can now keep the Python HTTP server running, and continue a cycle of making edits, running <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">html</span></code> in the <code class="docutils literal notranslate"><span class="pre">doc/</span></code> directory, and checking the resulting HTML until it is to your liking.</p>
<p>Once you’re happy, commit, push, make PRs, and communicate happily with your team on your progress!</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./Hw"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Philip Stark and Fernando Pérez<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>
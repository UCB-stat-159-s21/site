
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Homework 7: Permute - contributing to an open source project &#8212; Collaborative and Reproducible Data Science</title>
    
  <link rel="stylesheet" href="../_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.e7340bb3dbd8dde6db86f25597f54a1b.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.7d483ff0a819d6edff12ce0b1ead3928.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Collaborative and Reproducible Data Science</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../overview.html">
   Statistics 159/259, Spring 2021 Course Summary
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Overview
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../schedule.html">
   Statistics 159/259: Weekly Plan
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Syllabus
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../syllabus.html">
   Syllabus for Statistics 159/259: Reproducible and Collaborative Statistical Data Science
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Homework Assignments
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="hw01-background.html">
   1. Homework 1. Stats review and intro to Git
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="hw02-election-fraud.html">
   2. Homework 2. Election Fraud
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="hw03-testing.html">
   3. Homework 3: Coding style, docstrings, algorithmic choices, and unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="hw04-phil-sci-covid.html">
   4. Homework 4: Reproducibility, Philosophy of Science, and COVID-19 Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="hw05-selection-outliers.html">
   5. Homework 5: Selective inference and outlier rejection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="hw06-cryptorandom-contrib.html">
   6. Homework 6: Cryptorandom - contributing to an open source project
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="hw06-cryptorandom-tips.html">
   7. Some tips for HW06
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Lecture Notes
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../Notes/index.html">
   An Idiosyncratic Sample of Applied Statistics
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Lecture Index
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../Index/index.html">
   Index of Lectures and Materials
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/Hw/hw07-permute-contrib.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->


            <!-- Full screen (wrap in <a> to have style consistency -->
            <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                    data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                    title="Fullscreen mode"><i
                        class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i>
            Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#grading">
   Grading
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#workflow">
   Workflow
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#tips-for-this-assignment">
   Tips for this assignment
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#initial-setup-personal-and-team-repositories">
     Initial setup: personal and team repositories
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#install-permute-locally-in-development-mode">
     Install
     <code class="docutils literal notranslate">
      <span class="pre">
       permute
      </span>
     </code>
     locally in development mode
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#set-up-the-sphinx-build-for-jupyterhub-hosted-viewing">
     Set up the Sphinx build for JupyterHub-hosted viewing
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#editing-the-docs-and-testing-your-build">
     Editing the docs and testing your build
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#development-workfow">
     Development workfow
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#general-suggestions-on-documentation">
     General suggestions on documentation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#general-suggestions-on-testing">
     General suggestions on testing
    </a>
   </li>
  </ul>
 </li>
</ul>

        </nav>
        
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="homework-7-permute-contributing-to-an-open-source-project">
<h1>Homework 7: Permute - contributing to an open source project<a class="headerlink" href="#homework-7-permute-contributing-to-an-open-source-project" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p><strong>Statistics 159/259, Spring 2021</strong></p></li>
<li><p><strong>Due 4/25/2021, 11:59PM PT</strong></p></li>
<li><p>Profs. Pérez and Stark, Department of Statistics, UC Berkeley.</p></li>
<li><p>This assignment is worth a maximum of <strong>60 points</strong>.</p></li>
<li><p>Assignment type: <strong>group</strong>.</p></li>
</ul>
<p>The purpose of this assignment is for your team to collaborate on the development
of new contributions to another real-world open source repository,
the <a class="reference external" href="https://github.com/statlab/permute"><code class="docutils literal notranslate"><span class="pre">permute</span></code></a> project we’ve discussed in class.<br />
The high-level goal of the assignment is to make contributions to <code class="docutils literal notranslate"><span class="pre">permute</span></code> in three areas:
<strong>functionality</strong>, <strong>tests</strong> of that functionality, and <strong>documentation</strong> of that functionality.</p>
<p>All of the changes will be to the <span class="xref myst">utils</span>
file.</p>
<p>The assignment involves improving and extending two existing functions:
<code class="docutils literal notranslate"><span class="pre">binom_conf_interval</span></code> and <code class="docutils literal notranslate"><span class="pre">hypergeom_conf_interval</span></code>.</p>
<p>Those functions compute 1-sided and 2-sided confidence intervals for the binomial
parameter <span class="math notranslate nohighlight">\(p\)</span> (<span class="math notranslate nohighlight">\(n\)</span> known)
and for the hypergeometric parameter <span class="math notranslate nohighlight">\(G\)</span> (<span class="math notranslate nohighlight">\(N\)</span> and <span class="math notranslate nohighlight">\(n\)</span> known).
The current implementations are variants of the “Clopper-Pearson” approach
(see <a class="reference external" href="https://www.jstor.org/stable/2676784?seq=1">Brown, Cai, and DasGupta (2001)</a>).</p>
<p>You will improve the two-sided intervals by adding a different method.
The notes on <a class="reference internal" href="../Notes/tests.html"><span class="doc std std-doc">hypothesis tests</span></a> and <a class="reference internal" href="../Notes/confidence-sets.html"><span class="doc std std-doc">confidence sets</span></a>
and code in those notes will probably be helpful.</p>
<p>Here are the goals of the assignment.
They apply both to <code class="docutils literal notranslate"><span class="pre">binom_conf_interval</span></code> and to <code class="docutils literal notranslate"><span class="pre">hypergeom_conf_interval</span></code>.</p>
<ol class="simple">
<li><p>Test the 1-sided confidence bounds that are already implemented.
i. Check whether they correctly implement the mathematics. Correct them if not.
ii. Check the endpoints are found in a numerically stable and efficient manner. Provide a better method if not.
iii. Add unit tests that exercise all the options.</p></li>
<li><p>Test the 2-sided confidence bounds that are already implemented.
(The <span class="math notranslate nohighlight">\(1-\alpha\)</span> Clopper-Pearson two-sided confidence bounds are the intersection
of a 1-sided upper <span class="math notranslate nohighlight">\(1-\alpha/2\)</span> confidence interval and a 1-sided
lower <span class="math notranslate nohighlight">\(1-\alpha/2\)</span> confidence interval.)
i. Check whether the functions correctly implement the mathematics. Correct them if not.
ii. Add unit tests that exercise all the options.</p></li>
<li><p>Extend the signature of the functions to include a <code class="docutils literal notranslate"><span class="pre">method</span></code> parameter. The default value
of <code class="docutils literal notranslate"><span class="pre">method</span></code> should be “<code class="docutils literal notranslate"><span class="pre">clopper-pearson</span></code>”. The <code class="docutils literal notranslate"><span class="pre">method</span></code> parameter should not affect how
1-sided confidence bounds are calculated.
i. When <code class="docutils literal notranslate"><span class="pre">method=&quot;clopper-pearson&quot;</span></code>, the 2-sided intervals should be calculated as the
intersection of the 1-sided intervals using confidence level <span class="math notranslate nohighlight">\(1-\alpha/2\)</span>, based on
the current implementation of the 1-sided bounds (or on your modification
of the current implentation, if you improve them). This amounts
to inverting 2-sided, significance level <span class="math notranslate nohighlight">\(\alpha\)</span> hypothesis tests where the
chance that the observation will be larger than the largest value in the acceptance region
is not greater than <span class="math notranslate nohighlight">\(\alpha/2\)</span> and the chance that the observation will be smaller than the
smallest value in the acceptance region is not greater than <span class="math notranslate nohighlight">\(\alpha/2\)</span>.
That is, it balances the probability of the tails.
ii. When <code class="docutils literal notranslate"><span class="pre">method=&quot;smallest-ar&quot;</span></code>, the 2-sided intervals should be calculated by inverting
tests that have the <em>smallest</em> acceptance regions, following the approaches in the notes.
Rather than balance the probability of the tails, this approach minimizes the
number of outcomes in the acceptance region, which tends to produce shorter confidence
intervals.
To implement this method, consider writing helper functions that calculate the acceptance regions.
That will make it easier to debug and test your work.
<strong>Note that there might be a bug in the implementation of 2-sided confidence bounds
for binomial <span class="math notranslate nohighlight">\(p\)</span> in the notes. Be sure you are implementing the right thing!</strong>
iii. If <code class="docutils literal notranslate"><span class="pre">method</span></code> takes any other value, the code should raise an exception.
iv. Provide unit tests for the new functionality and any helper functions.
v. Provide appropriate docstrings for the new functionality.
vi. Follow PEP-8 and PEP-257.</p></li>
<li><p>Calculate (not simulate) the expected width of the 2-sided 95%
confidence intervals for
<code class="docutils literal notranslate"><span class="pre">method=&quot;clopper-pearson&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">method=&quot;smallest-ar&quot;</span></code> for a range of values of
<span class="math notranslate nohighlight">\(n\)</span> and <span class="math notranslate nohighlight">\(p\)</span> (for the binomial) and for <span class="math notranslate nohighlight">\(N\)</span>, <span class="math notranslate nohighlight">\(G\)</span>, and <span class="math notranslate nohighlight">\(n\)</span> (for the hypergeometric).
i. This should be turned in separately as a Jupyter notebook.
ii. See the top of the left column of p.111 of <a class="reference external" href="https://www.jstor.org/stable/2676784?seq=1">Brown, Cai, and DasGupta (2001)</a>
for a hint of how to calculate the expected length of binomial confidence intervals.
The expression for hypergeometric is analogous, but should use the hypergeometric
pmf rather than the binomial pmf.
iii. Discuss the difference between the two methods.
iv. Which would you recommend, and why? If you would recommend one method over the other
in some circumstances but not in other circumstances, explain why.</p></li>
</ol>
<p>Think of this project as a scenario where your team are developers and
maintainers of <code class="docutils literal notranslate"><span class="pre">permute</span></code>.
You are starting from the code in its current state, and are going to work on the next release of the project.
You will have to:</p>
<ul class="simple">
<li><p>specify the new functionality to be added</p></li>
<li><p>create appropriate GitHub issues</p></li>
<li><p>assign issues to team members</p></li>
<li><p>review each other’s work, that will be submitted to the team repository in the form of Pull Requests (PRs)</p></li>
<li><p>provide feedback and discussion for each PR</p></li>
<li><p>ensure that each PR passes all existing tests and adds new ones as necessary
The project repo is already configured to run the test suite with Github Actions,
but you will need to ensure that any changes you make are still covered by the automated execution.</p></li>
</ul>
<p>While each team will work against a private fork of the official <code class="docutils literal notranslate"><span class="pre">permute</span></code> repo,
we hope to later incorporate some of your contributions (with full public credit going to you)
into the public repo.
But your grade will <em>not</em> be based on that–we only want you to be aware of this for you to
know that we consider this a “real world” project.</p>
<div class="section" id="grading">
<h2>Grading<a class="headerlink" href="#grading" title="Permalink to this headline">¶</a></h2>
<p>The entire assignment is worth 60 points, broken down as follows:</p>
<ul class="simple">
<li><p>25 points: contributions to testing.</p></li>
<li><p>25 points: contributions to documentation.</p></li>
<li><p>10 points: release notes.</p></li>
</ul>
<p>For each of the main areas (testing and documentation) we will look at the following aspects to assign points:</p>
<ul class="simple">
<li><p>Completeness and correctness of the issue addressed (new documentation or test). Each PR should be a meaningful contribution to the codebase, that is, it should actually improve the quality of the documentation or the coverage of the test suite, both in terms of line coverage and conceptual coverage.</p></li>
<li><p>Open source workflow:</p>
<ul>
<li><p>Was a clear issue opened before starting work on the problem?</p></li>
<li><p>Was the PR created with a clean set of commits that each address a separate part of the problem, and that contain descriptive commit messages?</p></li>
<li><p>Was the contribution correctly reviewed by team members, with appropriate feedback?</p></li>
<li><p>Did all members of the team participate in each aspect of the workflow? That is, creating issues, providing feedback, writing code, reviewing each other’s PRs with meaningful feedback, etc?</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="workflow">
<h2>Workflow<a class="headerlink" href="#workflow" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>You will be assigned to a team of 4–5 students.</p>
<ul>
<li><p>Each team will need to decide how to coordinate its work.</p></li>
<li><p>We will provide a private Slack channel for each team for “small” communication. You can call us for help there with the usual <code class="docutils literal notranslate"><span class="pre">&#64;instructors</span></code> tag.</p></li>
</ul>
</li>
<li><p>You <em>must</em> use Github issues as a “bulletin board” for each PR you will create. It’s a good idea to create an issue describing the work you intend to do, and then create the PR that addresses it and closes it when merged. You can use <a class="reference external" href="https://docs.github.com/en/github/managing-your-work-on-github/linking-a-pull-request-to-an-issue">GitHub’s automated linking of PRs, issues and commits</a> to streamline this process.</p></li>
<li><p>Your deliverable will consist of your team repository with a collection of merged or closed pull requests that implement all the requested functionality.</p></li>
<li><p>You will include at the top of the repository a file named <code class="docutils literal notranslate"><span class="pre">hw06-summary.md</span></code> that summarizes all your work, along with a PDF render of the same. This file should amount to <em>release notes</em> that include:</p>
<ul>
<li><p>a description of problems and gaps you found in the current docstrings</p></li>
<li><p>a description of problems and gaps you found in the main documentation</p></li>
<li><p>a description of problems and gaps you found in the unit tests</p></li>
<li><p>a description of each of your new tests and the functionality it tests</p></li>
<li><p>the coverage reports for your team’s test PR.</p></li>
</ul>
</li>
<li><p>As an illustration of the kind of level of description and detail we have in mind, you can consult the <a class="reference external" href="https://github.com/numpy/numpy/releases/tag/v1.20.0">Numpy release notes</a>, but use your own judgment. You should think of this document as something that a third party interested in <code class="docutils literal notranslate"><span class="pre">permute</span></code> will be able to read to inform themselves about all the great new work that was done in this “new release.”</p></li>
<li><p>You will use a “pull cycle” development model. That is, no team member pushes directly to the team repository, but instead you each make your own personal fork of the team repo, and create pull requests into the team repo from your personal one.  This is how many real-world open source projects work (in fact, some enforce that no team member can push directly to the main repo even if they try).</p></li>
<li><p>Each team member will create a separate branch for the development of each new feature/idea in their personal repository, and will make from there a PR to the team repo.</p></li>
<li><p>Each team member <em>must</em> make at least one PR related to documentation and one PR related to testing.</p>
<ul>
<li><p>Each PR should be reviewed by <em>at least</em> another student, with discussion and feedback provided in the PR.</p></li>
<li><p>Not all PRs need to be merged, but all need to be finalized: either merged, or closed with an appropriate discussion of why the team decided not to merge it.</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="tips-for-this-assignment">
<h2>Tips for this assignment<a class="headerlink" href="#tips-for-this-assignment" title="Permalink to this headline">¶</a></h2>
<p><em>Note:</em> some of these tips were previously in a separate document, now merged here as part of the homework (partly so the automated numbering scheme matches our homework numbers).</p>
<p>These notes should help you work through some of the issues we discussed in lecture, regarding how to render the sphinx documentation for <code class="docutils literal notranslate"><span class="pre">permute</span></code> in the hub, and how to then view your own build of these docs through the hub.</p>
<p>Basically we need to solve the following problems:</p>
<ol class="simple">
<li><p>We need to ensure that pytest, Sphinx and other tools find and use our in-development version of <code class="docutils literal notranslate"><span class="pre">permute</span></code> instead of the system-wide one, so our new work is reflected in the tests and documentation we create.</p></li>
<li><p>We need to be able to build the documentation on JupyterHub and view the resulting docs online easily, through the Hub.</p></li>
</ol>
<p>Credit and huge thanks to <a class="reference external" href="https://github.com/yuvipanda">Yuvi Panda</a> from the JupyterHub/Berkeley team for his help navigating the proxy issues detailed below.</p>
<div class="section" id="initial-setup-personal-and-team-repositories">
<h3>Initial setup: personal and team repositories<a class="headerlink" href="#initial-setup-personal-and-team-repositories" title="Permalink to this headline">¶</a></h3>
<p>You will need to fork the team repo to your personal user and then clone your personal fork into the hub.
That will be your “working space”, one for each member of the team.
You will do all your work in your personal copy, pushing your changes up to github in your personal fork,
and then from there, making PRs to the team repo.</p>
<p>As we discussed in class, a good way to track both is to have <em>two</em> remotes,
using your personal fork as <code class="docutils literal notranslate"><span class="pre">origin</span></code> and the team repo as <code class="docutils literal notranslate"><span class="pre">upstream</span></code>.
This also makes it convenient to have more remotes if for example you want to check locally
the work of your teammate whose github username is <code class="docutils literal notranslate"><span class="pre">alice</span></code> by having a remote of that name.
As an illustration, this is what my remotes setup for the <code class="docutils literal notranslate"><span class="pre">permute</span></code> repo looks like on my system:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">base</span><span class="p">)</span> <span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="n">blanca</span><span class="p">[</span><span class="n">permute</span><span class="p">]</span><span class="o">&gt;</span> <span class="n">git</span> <span class="n">remote</span> <span class="o">-</span><span class="n">v</span>
<span class="n">origin</span>	<span class="n">git</span><span class="nd">@github</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="n">fperez</span><span class="o">/</span><span class="n">permute</span><span class="o">.</span><span class="n">git</span> <span class="p">(</span><span class="n">fetch</span><span class="p">)</span>
<span class="n">origin</span>	<span class="n">git</span><span class="nd">@github</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="n">fperez</span><span class="o">/</span><span class="n">permute</span><span class="o">.</span><span class="n">git</span> <span class="p">(</span><span class="n">push</span><span class="p">)</span>
<span class="n">upstream</span>	<span class="n">git</span><span class="nd">@github</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="n">statlab</span><span class="o">/</span><span class="n">permute</span><span class="o">.</span><span class="n">git</span> <span class="p">(</span><span class="n">fetch</span><span class="p">)</span>
<span class="n">upstream</span>	<span class="n">git</span><span class="nd">@github</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="n">statlab</span><span class="o">/</span><span class="n">permute</span><span class="o">.</span><span class="n">git</span> <span class="p">(</span><span class="n">push</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="install-permute-locally-in-development-mode">
<h3>Install <code class="docutils literal notranslate"><span class="pre">permute</span></code> locally in development mode<a class="headerlink" href="#install-permute-locally-in-development-mode" title="Permalink to this headline">¶</a></h3>
<p>The first issue we must solve is for Sphinx to find the version of <code class="docutils literal notranslate"><span class="pre">permute</span></code> that you are working on, rather than the installed one. This manifests itself immediately as the <code class="docutils literal notranslate"><span class="pre">AttributeError</span></code> you see regarding a missing <code class="docutils literal notranslate"><span class="pre">__version__</span></code> attribute when trying to build the docs, but even if you fix that with a quick hack as I did in lecture, you’ll still have a problem. The issue is that the docs will import the <em>system-wide installed</em> version of <code class="docutils literal notranslate"><span class="pre">permute</span></code>, and not your local development copy. So any new docstrings or function signatures you edit will not be correctly reflected in the resulting docs.</p>
<p>The solution is to install your working copy as a <em>development version</em>, also known as an <em>“editable install”</em> (hence the <code class="docutils literal notranslate"><span class="pre">-e</span></code> command line argument, short for <code class="docutils literal notranslate"><span class="pre">--editable</span></code>). We now explain how to do this, and you can find more details in the <a class="reference external" href="https://pip.pypa.io/en/stable/reference/pip_install/#editable-installs">pip documentation</a>.</p>
<p>In the top-level of the <code class="docutils literal notranslate"><span class="pre">permute</span></code> directory, where the file <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> lives, run the command:</p>
<p><code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">-e</span> <span class="pre">.</span></code></p>
<p>You should see something like the following output (with your own user name in the path):</p>
<p><strong>THIS WILL BE DIFFERENT SINCE PERMUTE USES CRYPTORANDOM</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">jovyan</span><span class="nd">@jupyter</span><span class="o">-</span><span class="n">fernando</span><span class="o">-</span><span class="mi">2</span><span class="n">eperez</span><span class="p">:</span><span class="o">~/</span><span class="n">permute</span><span class="o">&gt;</span> <span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">e</span> <span class="o">.</span>
<span class="n">Obtaining</span> <span class="n">file</span><span class="p">:</span><span class="o">///</span><span class="n">home</span><span class="o">/</span><span class="n">jovyan</span><span class="o">/</span><span class="n">permute</span>
<span class="n">Requirement</span> <span class="n">already</span> <span class="n">satisfied</span><span class="p">:</span> <span class="n">numpy</span><span class="o">&gt;=</span><span class="mf">1.20</span> <span class="ow">in</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">conda</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="o">.</span><span class="mi">8</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span> <span class="p">(</span><span class="kn">from</span> <span class="nn">permute</span><span class="o">==</span><span class="mf">0.3</span><span class="n">rc2</span><span class="o">.</span><span class="n">dev0</span><span class="p">)</span> <span class="p">(</span><span class="mf">1.20</span><span class="o">.</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Requirement</span> <span class="n">already</span> <span class="n">satisfied</span><span class="p">:</span> <span class="n">scipy</span><span class="o">&gt;=</span><span class="mf">1.6</span> <span class="ow">in</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">conda</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="o">.</span><span class="mi">8</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span> <span class="p">(</span><span class="kn">from</span> <span class="nn">permute</span><span class="o">==</span><span class="mf">0.3</span><span class="n">rc2</span><span class="o">.</span><span class="n">dev0</span><span class="p">)</span> <span class="p">(</span><span class="mf">1.6</span><span class="o">.</span><span class="mi">0</span><span class="p">)</span>
<span class="n">Installing</span> <span class="n">collected</span> <span class="n">packages</span><span class="p">:</span> <span class="n">permute</span>
  <span class="n">Attempting</span> <span class="n">uninstall</span><span class="p">:</span> <span class="n">permute</span>
    <span class="n">Found</span> <span class="n">existing</span> <span class="n">installation</span><span class="p">:</span> <span class="n">permute</span> <span class="mf">0.2</span>
    <span class="n">Uninstalling</span> <span class="n">permute</span><span class="o">-</span><span class="mf">0.2</span><span class="p">:</span>
      <span class="n">Successfully</span> <span class="n">uninstalled</span> <span class="n">permute</span><span class="o">-</span><span class="mf">0.2</span>
  <span class="n">Running</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="n">develop</span> <span class="k">for</span> <span class="n">permute</span>
<span class="n">Successfully</span> <span class="n">installed</span> <span class="n">permute</span>
</pre></div>
</div>
<p>Check that you got it right by doing the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">doc</span><span class="o">/</span>
<span class="n">python</span> <span class="o">-</span><span class="n">c</span> <span class="s2">&quot;import permute as pm;print(pm.__version__)&quot;</span>
</pre></div>
</div>
<p>You should see:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">jovyan</span><span class="nd">@jupyter</span><span class="o">-</span><span class="n">fernando</span><span class="o">-</span><span class="mi">2</span><span class="n">eperez</span><span class="p">:</span><span class="o">~/</span><span class="n">permute</span><span class="o">&gt;</span> <span class="n">cd</span> <span class="n">doc</span><span class="o">/</span>
<span class="n">jovyan</span><span class="nd">@jupyter</span><span class="o">-</span><span class="n">fernando</span><span class="o">-</span><span class="mi">2</span><span class="n">eperez</span><span class="p">:</span><span class="o">~/</span><span class="n">permute</span><span class="o">/</span><span class="n">doc</span><span class="o">&gt;</span> <span class="n">python</span> <span class="o">-</span><span class="n">c</span> <span class="s2">&quot;import permute as pm;print(pm.__version__)&quot;</span>
<span class="mf">0.3</span><span class="n">rc2</span><span class="o">.</span><span class="n">dev0</span>
</pre></div>
</div>
</div>
<div class="section" id="set-up-the-sphinx-build-for-jupyterhub-hosted-viewing">
<h3>Set up the Sphinx build for JupyterHub-hosted viewing<a class="headerlink" href="#set-up-the-sphinx-build-for-jupyterhub-hosted-viewing" title="Permalink to this headline">¶</a></h3>
<p>Now we turn to the second problem: once we build our docs with Sphinx against our development version, how do we look at the built HTML results? These files are hosted in the Hub, not our home computer, so we can’t easily view them immediately. While JupyterLab can display individual HTML files, this will not show a fully styled version with all the necessary extra assets such as images, CSS, etc.  We need to use a full <em>web server</em> for that, and we need to be able to access that web server from outside the Hub. We now explain how to achieve this.</p>
<p>First, you need to make a change to <code class="docutils literal notranslate"><span class="pre">conf.py</span></code> so that the build can be seen through a JupyterHub installation.
This change can probably go into permute proper in the end, but for now we suggest you make it directly into the team repo in a single commit, that all team members then pull from, so you all have it in one place. You need to add three lines below - the comment is there in the file already, around line 108, and we leave it here for ease of reference. You neeed to add the code starting with <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">os</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># -- Options for HTML output ----------------------------------------------</span>

<span class="kn">import</span> <span class="nn">os</span>

<span class="k">if</span> <span class="s2">&quot;JUPYTERHUB_SERVICE_PREFIX&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
    <span class="n">html_baseurl</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;JUPYTERHUB_SERVICE_PREFIX&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">/proxy/absolute/8000&#39;</span>
</pre></div>
</div>
<p>Just to make sure these changes apply everywhere, in the <code class="docutils literal notranslate"><span class="pre">doc/</span></code> directory run <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">clean</span></code>
once after the above, and then continue with the below.
In what follows you may want to keep at least <em>two</em> terminals open, one where you keep
running the HTML Sphinx build, and one to run the server to check your builds (some might keep a third open in the top-level directory for git work, commits, pushes, etc). Take advantage of JupyterLab’s ability to lay them out in whatever way you find most visually convenient!</p>
<p>Once you make these changes you should commit and push them to the team repo, and all
members need to ensure they pull from that correctly and they all have the same <code class="docutils literal notranslate"><span class="pre">conf.py</span></code>.</p>
</div>
<div class="section" id="editing-the-docs-and-testing-your-build">
<h3>Editing the docs and testing your build<a class="headerlink" href="#editing-the-docs-and-testing-your-build" title="Permalink to this headline">¶</a></h3>
<p>Make your edits and run <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">html</span></code> in the <code class="docutils literal notranslate"><span class="pre">doc/</span></code> directory.<br />
To check your build, then go to your other terminal (if you chose to have more than one)
and go to the <code class="docutils literal notranslate"><span class="pre">build/html</span></code> subdirectory.
There, run:</p>
<p><code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-m</span> <span class="pre">http.server</span></code></p>
<p>as we saw today in class.  This will print a message like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">jovyan</span><span class="nd">@jupyter</span><span class="o">-</span><span class="n">fernando</span><span class="o">-</span><span class="mi">2</span><span class="n">eperez</span><span class="p">:</span><span class="o">~/</span><span class="n">permute</span><span class="o">/</span><span class="n">doc</span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">html</span><span class="o">&gt;</span> <span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">http</span><span class="o">.</span><span class="n">server</span>
<span class="n">Serving</span> <span class="n">HTTP</span> <span class="n">on</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span> <span class="n">port</span> <span class="mi">8000</span> <span class="p">(</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span><span class="p">:</span><span class="mi">8000</span><span class="o">/</span><span class="p">)</span> <span class="o">...</span>
</pre></div>
</div>
<p>but you can <em>not</em> access <code class="docutils literal notranslate"><span class="pre">http://0.0.0.0:8000</span></code> as we explained today in class, as on your home computer that would correspond to a local port. Instead you need to reach that port but on the Stat159 DataHub!</p>
<p>In order to support that, the Hub runs what is called a proxy service, that basically hooks up port 8000 on the Hub service to a publicly available path on the internet, so that you can see that internal port from your home computer.</p>
<p>The file you are trying to reach is <code class="docutils literal notranslate"><span class="pre">index.html</span></code> at the <code class="docutils literal notranslate"><span class="pre">doc/build/html</span></code> directory, being served on port 8000 on the server. To access that file from home, instead you tell your laptop to go to:</p>
<p>https://stat159.datahub.berkeley.edu/user-redirect/proxy/8000/index.html</p>
<p>(if you had configured the python HTTP server to use a different port than 8000 you’d change that number, and similarly if the name of the file you wanted to look at was different you’d adjust the path).</p>
<p>That URL will automatically change to a different one, with your username, and should show you the build of the docs. This is what that looks like for me when it’s all running:</p>
<p><img alt="" src="../_images/hw06-sphinx-build-hub-proxy-view.png" /></p>
<p>As a side note, you may want to explore using <a class="reference external" href="https://github.com/executablebooks/sphinx-autobuild">sphinx-autobuild</a>, a tool that automatically builds and reloads your Sphinx docs as you make changes. I haven’t personally tested it yet but it looks interesting, it is developed by the same team from the Executable Books project that builds JupyterBook.</p>
</div>
<div class="section" id="development-workfow">
<h3>Development workfow<a class="headerlink" href="#development-workfow" title="Permalink to this headline">¶</a></h3>
<p>You can now keep the Python HTTP server running, and continue a cycle of making edits, running <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">html</span></code> in the <code class="docutils literal notranslate"><span class="pre">doc/</span></code> directory, and checking the resulting HTML until it is to your liking.</p>
<p>Once you’re happy, commit, push, make PRs, and communicate happily with your team on your progress!</p>
</div>
<div class="section" id="general-suggestions-on-documentation">
<h3>General suggestions on documentation<a class="headerlink" href="#general-suggestions-on-documentation" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>check the docstrings within <code class="docutils literal notranslate"><span class="pre">utils.py</span></code> and edit/augment them as you see fit.</p></li>
<li><p>check whether the formal documentation accurately portrays the code.</p></li>
<li><p>Read <a class="reference external" href="https://documentation.divio.com">this discussion about Four types of documentation</a> for inspiration - you can make contributions in each of these dimensions. Docstrings aren’t the only thing you can work on!</p></li>
<li><p>To build the documentation you can type <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">html</span></code> in the <code class="docutils literal notranslate"><span class="pre">doc/</span></code> subdirectory.</p></li>
</ul>
</div>
<div class="section" id="general-suggestions-on-testing">
<h3>General suggestions on testing<a class="headerlink" href="#general-suggestions-on-testing" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Identify code that is not currently tested</p></li>
<li><p>Identify tests that do not really “exercise” the code
- Make one PR that aims to push line-based test coverage as close to 100% as possible. This PR should also have individual tests that add <em>conceptual</em> test coverage in areas currently not covered.</p></li>
<li><p>To run the test suite, you can run <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">test-all</span></code> from the top-level directory, which is the same command that <a class="reference external" href="https://github.com/statlab/permute/actions/workflows/test.yml">the testing GitHub action uses</a>.</p></li>
</ul>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./Hw"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Philip Stark and Fernando Pérez<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>